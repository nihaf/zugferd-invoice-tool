<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title th:text="#{index.title}">E-Invoice Tool</title>
</head>
<body>
<main layout:fragment="content">
    <!-- Hero Section -->
    <section class="hero">
        <h1 th:text="#{index.title}">E-Rechnung erstellen</h1>
        <p class="hero-subtitle" th:text="#{index.subtitle}">
            PDF-Rechnung hochladen und in eine ZUGFeRD-konforme E-Rechnung umwandeln
        </p>
    </section>

    <div class="row">
        <!-- Upload Section -->
        <div class="column column-67">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title" th:text="#{index.upload.title}">PDF hochladen</h3>
                </div>
                <div class="card-body">
                    <form th:action="@{/upload}" method="post" enctype="multipart/form-data" id="uploadForm">
                        <!-- Drop Zone -->
                        <div class="upload-zone" id="dropZone">
                            <div class="upload-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                            </div>
                            <p class="upload-text" th:text="#{index.upload.description}">
                                PDF-Datei hier ablegen oder auswaehlen
                            </p>
                            <input type="file" name="file" id="fileInput" accept="application/pdf" class="hidden" required>
                            <button type="button" class="button button-outline" id="chooseFileBtn">
                                <span th:text="#{index.upload.button}">Datei auswaehlen</span>
                            </button>
                            <p class="upload-hint" th:text="#{index.upload.hint}">
                                Maximale Dateigr√∂sse: 10 MB
                            </p>
                        </div>

                        <!-- Selected File Info -->
                        <div id="fileInfo" class="file-info hidden">
                            <span class="file-icon">&#128196;</span>
                            <span class="file-name" id="fileName"></span>
                            <span class="file-size" id="fileSize"></span>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="button button-primary button-large button-block" id="submitBtn" disabled>
                            <span class="spinner hidden" id="uploadSpinner"></span>
                            <span th:text="#{index.upload.continue}">Weiter</span>
                            <span class="arrow">&#8594;</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="column column-33">
            <div class="card card-features">
                <div class="card-header">
                    <h3 class="card-title" th:text="#{index.features.title}">Funktionen</h3>
                </div>
                <div class="card-body">
                    <ul class="feature-list">
                        <li>
                            <span class="check">&#10003;</span>
                            <span th:text="#{index.features.zugferd}">ZUGFeRD 2.1 konform</span>
                        </li>
                        <li>
                            <span class="check">&#10003;</span>
                            <span th:text="#{index.features.pdfa3}">PDF/A-3 Standard</span>
                        </li>
                        <li>
                            <span class="check">&#10003;</span>
                            <span th:text="#{index.features.validation}">VeraPDF Validierung</span>
                        </li>
                        <li>
                            <span class="check">&#10003;</span>
                            <span th:text="#{index.features.en16931}">EN16931 Profil</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="card card-info">
                <div class="card-body">
                    <h4>Was ist ZUGFeRD?</h4>
                    <p>
                        ZUGFeRD ist ein deutsches Format fuer elektronische Rechnungen,
                        das eine PDF-Datei mit eingebetteten XML-Daten kombiniert.
                    </p>
                </div>
            </div>
        </div>
    </div>
</main>

<th:block layout:fragment="scripts">
<script>
document.addEventListener('DOMContentLoaded', function() {
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const submitBtn = document.getElementById('submitBtn');
    const uploadForm = document.getElementById('uploadForm');
    const uploadSpinner = document.getElementById('uploadSpinner');

    // Drag and Drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => dropZone.classList.add('drag-over'), false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => dropZone.classList.remove('drag-over'), false);
    });

    dropZone.addEventListener('drop', function(e) {
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect(files[0]);
        }
    });

    // File selection
    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            handleFileSelect(this.files[0]);
        }
    });

    // Open file dialog helper
    function openFileDialog() {
        fileInput.value = '';
        fileInput.click();
    }

    // Button click
    document.getElementById('chooseFileBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        openFileDialog();
    });

    // Click anywhere in dropZone to open file dialog
    dropZone.addEventListener('click', openFileDialog);

    function handleFileSelect(file) {
        if (file.type !== 'application/pdf') {
            alert('Bitte waehlen Sie eine PDF-Datei.');
            return;
        }

        fileName.textContent = file.name;
        fileSize.textContent = '(' + formatFileSize(file.size) + ')';
        fileInfo.classList.remove('hidden');
        submitBtn.disabled = false;
    }

    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    // Form submission
    uploadForm.addEventListener('submit', function() {
        submitBtn.disabled = true;
        uploadSpinner.classList.remove('hidden');
    });
});
</script>
</th:block>
</body>
</html>
